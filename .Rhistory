jenf == "LE PLUS JEUNE A DE 25 MOIS A 5 ANS" ~ "YOUNGEST CHILD 2-5 Y.O.",
jenf == "LE PLUS JEUNE A DE 6 A 10 ANS" ~ "YOUNGEST CHILD 6-10 Y.O.",
jenf == "LE PLUS JEUNE A MOINS DE 25 MOIS" ~ "YOUNGEST CHILD < 2 Y.O.",
jenf == "PAS D ENFANT" ~ "NO CHILDREN"
),
habi_inra = case_when(
habi_inra == "COMMUNES RURALES" ~ "RURAL AREAS",
habi_inra == "PARIS + AGGLOMERATION" ~ "PARIS URBAN AREA",
TRUE ~ habi_inra
),
habi_inra = gsub("HABITANTS", "INHABITANTS", habi_inra),
habi_inra = gsub("UNITES URBAINES DE", "URBAN AREAS FROM", habi_inra),
habi_inra = gsub(" A ", " TO ", habi_inra),
habi_inra = gsub(" ET PLUS", "", habi_inra)
)%>%
select(
-age1, -age2, -ageind1, -ageind2, -etud1, -etud2
)
household_cleaner2 = household_cleaner1%>%
mutate(
young_highly_educated_single =
(max_age < 35) & (max_etud >= 6) & single,
educated_parents_middle_high_income =
cycle %in% c(
"FAMILY (ELDEST CHILD 0-5 Y.O.)",
"FAMILY (ELDEST CHILD 6-11 Y.O.)",
"FAMILY (ELDEST CHILD 12-17 Y.O.)"
) & (max_etud >= 5) &
clas %in% c(
"HIGH MIDDLE INCOME",
"HIGH INCOME"
)
)
household_renamed = household_cleaner2%>%
select(
-hhid,
-rve_num,
-single
)%>%
mutate(
max_etud = case_when(
max_etud == 1 ~ "UNDER PRIMARY EDUCATION",
max_etud == 2 ~ "PRIMARY EDUCATION",
max_etud == 3 ~ "SECONDARY EDUCATION",
max_etud == 4 ~ "VOCATIONNAL TRAINING",
max_etud == 5 ~ "TWO YEARS OF HIGHER EDUCATION",
max_etud == 6 ~ "THREE YEARS OF HIGHER EDUCATION",
max_etud == 7 ~ "FIVE YEARS OF HIGHER EDUCATION"
)
)%>%
rename(
`Life Cycle` = cycle,
`Income` = clas,
`Children` = jenf,
`Area` = habi_inra,
`Education` = max_etud,
`Pre-tax Income` = rve,
`Age (Oldest Household Member)` = max_age,
`Young Highly-Educated Single` = young_highly_educated_single,
`Educated Parents with Middle or High Income` = educated_parents_middle_high_income
)
srcv = readRDS("E:/RA/WB_Inequality/Inputs/df_filtered_srcv.rds")
load("E:/RA/WB_Inequality/Inputs/srcv_complement.Rda")
tbl_summary(
srcv%>%
filter(aenq == "2012")%>%
select(men, typmen15)%>%
unique() %>% select(typmen15)
)
tbl_summary(
srcv%>%
filter(aenq == "2012")%>%
group_by(men)%>%
summarise(
min_age = min(age),
age_below_35 = min_age<36,
age_above_65 = min_age>66
)%>%
ungroup()%>%
select(age_below_35, age_above_65)
)
tbl_summary(
srcv%>%
filter(aenq == "2012")%>%
group_by(men)%>%
summarise(
min_age = min(age),
age_below_35 = min_age<36,
age_above_65 = min_age>66
)%>%
ungroup()%>%
select(age_below_35, age_above_65)
)
product_without_nosale = readRDS("Inputs/product_without_nosale.rds")
shopping_trips_without_nosale = readRDS("Inputs/shopping_trips_without_nosale.rds")
shopping_trips_renamed = shopping_trips_without_nosale%>%
select(
-X, -hhid, -unit_price, -dateachat, -marque, -retailer, -periode
)%>%
mutate(
calibre = case_when(
calibre == "calibreL" ~ "L",
calibre == "calibreM" ~ "M"
),
label = case_when(
label == "labelbio" ~ "Organic",
label == "labelpleinair" ~ "Free-Range",
label == "nolabel" ~ "No Label"
),
marque_simple = case_when(
marque_simple == "high" ~ "Top-Range Retail Brand",
marque_simple == "medium" ~ "Medium-Range Retail Brand",
marque_simple == "low" ~ "Low-Range Retail Brand",
marque_simple == "indep" ~ "Popular National brand",
TRUE ~ "Other National Brand"
),
valqvol = as.factor(as.character(valqvol))
)%>%
rename(
Calibre = calibre,
Label = label,
`Box Size` = valqvol,
`Simplified Brand Category` = marque_simple
)
tbl_summary(shopping_trips_renamed)
shopping_trips_with_nosale = readRDS("Inputs/shopping_trips_with_nosale.rds")
# Nb retailers en tout
shopping_trips_with_nosale%>%
select(hhid, retailer)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
# Part des visites chez le principal retailer au niveau ménage
shopping_trips_with_nosale%>%
count(hhid, retailer)%>%
group_by(hhid)%>%
mutate(share_max_retailer = max(n)/sum(n))%>%
.$share_max_retailer%>%
#hist()
summary()
# Part des visites chez le principal retailer au niveau ménage x periode
shopping_trips_with_nosale%>%
count(hhid, retailer, periode)%>%
group_by(hhid, periode)%>%
mutate(share_max_retailer = max(n)/sum(n))%>%
.$share_max_retailer%>%
#hist()
summary()
# Nb retailers en tout
shopping_trips_with_nosale%>%
select(hhid, retailer)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
shopping_trips_with_nosale = readRDS("Inputs/shopping_trips_with_nosale.rds")
# Nb retailers en tout
shopping_trips_with_nosale%>%
select(hhid, retailer)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
# Nb retailers en tout
shopping_trips_with_nosale%>%
select(hhid, retailer, periode)%>%
unique()%>%
count(hhid, periode)%>%
.$n%>%
as.factor()%>%
summary()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_retailer_generalized = max(is_main_retailer))
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer))
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer))%>%
filter(is_main_egg_retailer_generalized)
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer)>0)%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer)>0)%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = (n == max(!nosale * n))
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = max(is_main_egg_retailer)>0)%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (is_main_egg_retailer == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
View()
group_by(hhid)%>%
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
mutate(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n))
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
mutate(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
summarise(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
summarise(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
View()
View(shopping_trips_with_nosale)
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, (!nosale * n))%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, nosale, n)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, nosale, n)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
summarise(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )%>%
View()
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, nosale, n)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
summarise(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )%>%
View()
share_empty_shopping_trips_at_main_retailer_for_eggs =
shopping_trips_with_nosale%>%
mutate(
nosale = (label == "nosale")
)%>%
count(nosale, hhid, retailer)%>%
arrange(hhid, nosale, n)%>%
group_by(hhid)%>%
mutate(
is_main_egg_retailer = 1:n()
)%>%
ungroup()%>%
group_by(hhid, retailer)%>%
mutate(is_main_egg_retailer_generalized = (min(is_main_egg_retailer) == 1))%>%
ungroup()%>%
filter(is_main_egg_retailer_generalized)%>%
group_by(hhid)%>%
summarise(share_nosale_main_egg_retailer = sum(n*nosale)/sum(n) )
summary(share_empty_shopping_trips_at_main_retailer_for_eggs$share_nosale_main_egg_retailer)
hist(share_empty_shopping_trips_at_main_retailer_for_eggs$share_nosale_main_egg_retailer)
### ROW 1 : NB RETAILER DURING THE YEAR
shopping_trips_with_nosale%>%
select(hhid, retailer)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
shopping_trips_without_nosale%>%
select(hhid, retailer)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
### ROW 2 : SHARE OF VISITS TO THE MAIN RETAILERS
shopping_trips_with_nosale%>%
count(hhid, retailer)%>%
group_by(hhid)%>%
mutate(share_max_retailer = max(n)/sum(n))%>%
.$share_max_retailer%>%
#hist()
summary()
shopping_trips_without_nosale%>%
count(hhid, retailer)%>%
group_by(hhid)%>%
mutate(share_max_retailer = max(n)/sum(n))%>%
.$share_max_retailer%>%
#hist()
summary()
shopping_trips_without_nosale%>%
select(hhid, periode)%>%
unique()%>%
count(hhid)%>%
.$n%>%
as.factor()%>%
summary()
